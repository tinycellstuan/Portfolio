'use strict';

var _commander = require('commander');

var _commander2 = _interopRequireDefault(_commander);

var _logger = require('../logger');

var _logger2 = _interopRequireDefault(_logger);

var _app = require('../app');

var _app2 = _interopRequireDefault(_app);

var _reports = require('../reports');

var _reports2 = _interopRequireDefault(_reports);

var _package = require('../../package.json');

var _package2 = _interopRequireDefault(_package);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var _exports = {};

_exports.setup = function (cliOptions) {

  var options = {};

  _commander2.default.version(_package2.default.version).option('-r, --reportType [reportType]', 'Report type [json]', 'json').option('-l, --reportLocation [reportLocation]', 'Report Location [reports]', 'reports').option('-f, --force', 'No failure in case of errors').option('-q, --quiet', 'No terminal output').parse(cliOptions);

  if (!_commander2.default.args.length) {
    _logger2.default.generalError('Please provide a filepath, url or string to check');
    return false;
  }

  // ADD IN REPORTS
  options.reportType = _commander2.default.reportType;
  options.reportLocation = _commander2.default.reportLocation;

  if (_commander2.default.force) {
    options.force = true;
  }

  if (_commander2.default.quiet) {
    options.verbose = false;
  }

  function writeReport(reportData) {
    if (options.reportType || options.reportLocation) {
      return (0, _reports2.default)(reportData, options);
    }
  }

  new _app2.default(options).run(_commander2.default.args).then(writeReport, function (result) {
    writeReport(result.reportLogs);
    return Promise.reject(result.errorMessage);
  });
};

module.exports = _exports;